Στέφανος Βάβουλας
Λειτουργικά Συστήματα - Εργασία 1

Περιεχόμενα: parent.c, child.c, file.txt, Makefile

Παράδειγμα εκτέλεσης (Οι αριθμοι 5 5 συμβολίζουν αριθμό παιδιών, αριθμό δοσοληψιών αντίστοιχα):

>make
>./parent file.txt 5 5
>make clean			(για δεύτερη εκτέλεση)
-------------------------------------------------------------------------------------------------------------------------------

Η αρχική (γονική) διεργασία δέχεται 3 ορίσματα: 
-Το αρχείο κειμένου(Χ), δηλαδή το file.txt στο οποίο έχω γράψει 20 τυχαίες προτάσεις
-Το πλήθος των διεργασιών παιδιών (K)
-Τον αριθμό(N) των δοσοληψιών για κάθε διεργασία-παιδί.

Στη συνέχεια, δημιουργεί 3 σημαφόρους (LOCK, CONS, PROD), και αρχικοποιεί ένα κομμάτι κοινής μνήμης (shared memory segment),
τα οποία χρησιμοποιεί για την επικοινωνία μεταξύ γονέα-παιδιών (Η λογική των σημαφόρων εξηγείται αναλυτικά στο τέλος του readme).
Mετράει τον αριθμό των γραμμών του αρχείου Χ και δημιουργεί K παιδιά γνωστοποιώντας τον αριθμό γραμμών του αρχείου Χ καθώς 
και το πλήθος των δοσοληψιών Ν που θα εκτελέσει το κάθε παιδί.

Οι διεργασίες-παιδιά ανακοινώνουν τη δημιουργία τους γράφοντας σε ένα νέο αρχείο test.txt. Στη συνέχεια διαμορφώνουν αιτήματα 
προς τη μητρική διεργασία ζητώντας μέσω της κοινής μνήμης μία τυχαία γραμμή του δοθέντος αρχείου. 

Η γονική διεργασία δέχεται το αίτημα ενός παιδιού, ανοίγει το αρχείο Χ και γράφει τη ζητούμενη πρόταση στην κοινή μνήμη.
Οι διεργασίες παιδιά καταγράφουν το χρόνο που παρέρχεται από την υποβολή του αιτήματος μέχρι τη λήψη της πρότασης 
(την αποθηκεύουν σε ένα πίνακα για να βρουν στο τέλος το μέσο χρονο), και αφού λάβουν την απάντηση, την εκτυπώνουν.

Η εκτέλεση των διεργασιών σταματάει όταν ολοκληρωθούν τα K*N συνολικά αιτήματα (Ν για κάθε παιδί).
Πριν ολοκληρώσει την εκτέλεσή του, κάθε παιδί υπολογίζει το μέσο χρόνο μεταξύ όλων των αιτημάτων του
και τον ανακοινώνει γράφοντας τον στο αρχείο test.txt που έχει δημιουργηθεί.

Η γονική διεργασία περιμένει να ολοκληρωθούν όλες οι διεργασίες παιδιά και πριν ολοκληρωθεί ανακοινώνει την πετυχημένη διαγραφή
των σημαφόρων και της κοινής μνήμης. 

Τυχόν λεπτομέρειες και επεξηγήσεις για μεταβλητές αναφέρονται και στα σχόλια του κώδικα.
--------------------------------------------------------------------------------------------------------------------------------

Σχετικά με τη λογική των σημαφόρων: 
Επέλεξα να υλοποιήσω τη λογική με την χρήση 3 σημαφόρων: LOCK, CONS, PROD (Αρχικές τιμές 1, 1, 0).

Ο πρώτος χρησιμοποιείται μόνο από τις διεργασίες παιδία και εξασφαλίζει ότι μόνο ένα παιδί τη φορά θα μπορεί
να έχει πρόσβαση στο κρίσιμο κομμάτι (critical section) στο οποίο γράφει και διαβάζει από την κοινή μνήμη.
Έτσι, στην αρχή κάθε επανάληψης για όλες τις διεργασίες παιδιά υπάρχει wait(LOCK) ώστε μόνο ένα τη φορά να εκτελεί
την διαδικασία αποστολής και παραλαβής μηνύματος με τη γονική διεργασία. Μόλις την ολοκληρώνει, κάνει post(LOCK),
ώστε το ίδιο ή κάποιο άλλο παιδί στη συνέχεια να εκτελέσει την wait.

Οι άλλοι δύο σημαφόροι χρησιμοποιούνται και από τον γονέα και το παιδί για να επιτύχουν σωστή επικοινωνία. 
Αρχικά, ο PROD, δηλαδή ο σημαφόρος που δείχνει στο γονέα ότι είναι η σειρά του, είναι ίσος με 0, ενώ ο CONS, που δείχνει στο
παιδί ότι είναι η σειρά του, είναι ίσος με 1. Επομένως, το πρώτο παιδί ξεκινά εκτελώντας την wait(CONS), αφου, προφανώς,
έχει περάσει από την wait(LOCK). Στη συνέχεια, γράφει ένα τυχαίο αριθμό γραμμής στην κοινή μνήμη, κάνει post(PROD) 
ώστε να δείξει στον γονέα ότι είναι η σειρά του και περιμένει σε δεύτερη wait(CONS). Ο γονέας με τη σειρά του εκτελεί
τώρα την wait(PROD), βλέπει τη γραμμή που αιτήθηκε στην κοινή μνήμη και γράφει στη θέση της την αντίστοιχη γραμμή του 
αρχείου. Τέλος, κάνει post(CONS) ώστε να δείξει στο παιδί ότι είναι η σειρά του και ολοκληρώνει την επανάληψη του, περιμένοντας
ξανά σε wait(PROD). Έτσι, το παιδί εκτελεί την wait(CONS), εκτυπώνει την γραμμή που βρίσκει στην κοινή μνήμη και κάνει 
post(LOCK) ώστε η διαδικασία της επικοινωνίας να ξαναρχίσει από την αρχή για νέο αίτημα κάποιου παιδιού.

Για τον έλεγχο της σωστής εκτέλεσης της παραπάνω διαδικασίας έχω σε σχόλια προαιρετικές printf στον γονέα και το παιδί που 
δείχνουν ότι συμβαίνει ακριβώς αυτή η διαδικασία που περιγράφεται.
-------------------------------------------------------------------------------------------------------------------------------

Σημείωση: 
sed -i -e "s/\r//g" file.txt
Εντολή για εκκαθάριση .txt αρχείου που μεταφέρεται από windows σε linux από χαρακτήρες αλλαγής γραμμής των windows.